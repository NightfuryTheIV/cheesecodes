<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Cheese Codes' prized project!</title>
        <link type="text/css" rel="stylesheet" href="../styles.css">
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap');
        </style>
    </head>

    <body>
<nav id="navbar">
        <div id="hotelname">Cheesecode house</div>
        <div id="search" onclick="document.querySelector('.search-box').scrollIntoView({behavior: 'smooth'})">Search</div>
        <div id="menu" onclick="alert('Menu en construction')">Menu</div>
        <div id="login" onclick="openLoginModal()">Log in</div>
    </nav>
    
    <section class="hero-section">
        <h1>Welcome to the Cheese Guesthouse</h1>
        <p>Your dream stay begins here!</p>
        <div class="search-box">
            <form class="search-form" onsubmit="searchRooms(event)">
                <div class="form-group">
                    <label>Check-in</label>
                    <input type="date" required>
                </div>
                <div class="form-group">
                    <label>Check-out</label>
                    <input type="date" required>
                </div>
                <div class="form-group">
                    <label>Number of adults</label>
                    <select required>
                        <option value="1">1 adult</option>
                        <option value="2">2 adults</option>
                        <option value="3">3 adults</option>
                        <option value="4">4 adults</option>
                    </select>
                </div>
                <button type="submit" class="search-btn">Search</button>
            </form>
        </div>
    </section>
    
    <section class="features">
        <h2>Services</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">ğŸŠâ€â™‚ï¸</div>
                <h3>Swimming Pool</h3>
                <p>Enjoy some relaxing time in our heated swimming pool with a beautiful view on the ocean!</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ½ï¸</div>
                <h3>Restaurant</h3>
                <p>Tasty food made by our renowned chefs made just for you!</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ’†â€â™€ï¸</div>
                <h3>Spa</h3>
                <p>Chill out in our premium spa</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ…¿ï¸</div>
                <h3>Parking lot</h3>
                <p>Private and secure parking lot for all of our clients</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ“¶</div>
                <h3>Free WiFi</h3>
                <p>High speed WiFi available everywhere in the hotel</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ‹ï¸â€â™‚ï¸</div>
                <h3>Gym</h3>
                <p>Gym opened 24/7!</p>
            </div>
        </div>
    </section>
    
    <section class="rooms-section">
        <h2>Rooms</h2>
        <div class="rooms-grid">
            <div class="room-card">
                <div class="room-image">ğŸ›ï¸</div>
                <div class="room-content">
                    <h3>Standard Room</h3>
                    <p>Comfortable room with queen-size bed, personal bathroom and sights on the garden.</p>
                    <div class="room-price">Â£89 per night</div>
                    <button class="book-btn" onclick="bookRoom('Standard')">RÃ©server</button>
                </div>
            </div>
            <div class="room-card">
                <div class="room-image">ğŸŒŸ</div>
                <div class="room-content">
                    <h3>Premium Room</h3>
                    <p>Vast room with a personal balcony, mini-bar and a breathtaking view on the landscape.</p>
                    <div class="room-price">Â£149  per night</div>
                    <button class="book-btn" onclick="bookRoom('Deluxe')">RÃ©server</button>
                </div>
            </div>
            <div class="room-card">
                <div class="room-image">ğŸ‘‘</div>
                <div class="room-content">
                    <h3>Preseidential Room</h3>
                    <p>Luxurious room with a large living room, jacuzzi and butlers available.</p>
                    <div class="room-price">Â£299 per night</div>
                    <button class="book-btn" onclick="bookRoom('PrÃ©sidentielle')">RÃ©server</button>
                </div>
            </div>
        </div>
    </section>
    
    <footer>
        <p>&copy; 2025 Cheesecode. All rights reserved.</p>
        <p>Stoke-on-Trent, England | contact@cheesecodehouse.com | +44 XXX XXX XXXX</p>
    </footer>
    
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeLoginModal()">&times;</span>
            <h2>Connexion</h2>
            <form class="login-form" onsubmit="handleLogin(event)">
                <input type="email" placeholder="Adresse e-mail" required>
                <input type="password" placeholder="Mot de passe" required>
                <button type="submit">Se connecter</button>
                <a href="#" onclick="alert('Fonction en construction')">Mot de passe oubliÃ© ?</a>
                <a href="#" onclick="alert('Fonction en construction')">CrÃ©er un compte</a>
            </form>
        </div>
    </div>
    <script>
const API_URL = 'http://localhost:3000/api';
// Attendre que la page soit complÃ¨tement chargÃ©e
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page chargÃ©e, initialisation...');
    
    // Ajouter des IDs aux inputs s'ils n'existent pas
    const dateInputs = document.querySelectorAll('input[type="date"]');
    if (dateInputs[0]) dateInputs[0].id = 'checkin';
    if (dateInputs[1]) dateInputs[1].id = 'checkout';
    
    const selectInput = document.querySelector('select');
    if (selectInput) selectInput.id = 'adults';
});

// Fonction de recherche de chambres
async function searchRooms(event) {
    event.preventDefault();
    console.log('searchRooms appelÃ©e');
    
    const checkinInput = document.getElementById('checkin');
    const checkoutInput = document.getElementById('checkout');
    const adultsInput = document.getElementById('adults');
    
    console.log('Elements trouvÃ©s:', { checkinInput, checkoutInput, adultsInput });
    
    if (!checkinInput || !checkoutInput || !adultsInput) {
        alert('âš ï¸ Erreur: Ã‰lÃ©ments du formulaire introuvables');
        return;
    }
    
    const checkin = checkinInput.value;
    const checkout = checkoutInput.value;
    const adults = adultsInput.value;
    
    console.log('Valeurs:', { checkin, checkout, adults });
    
    if (!checkin || !checkout) {
        alert('âš ï¸ Veuillez sÃ©lectionner les dates de check-in et check-out');
        return;
    }
    
    const checkinDate = new Date(checkin);
    const checkoutDate = new Date(checkout);
    
    if (checkoutDate <= checkinDate) {
        alert('âš ï¸ La date de check-out doit Ãªtre aprÃ¨s la date de check-in');
        return;
    }
    
    try {
        const url = `${API_URL}/rooms/search?checkin=${checkin}&checkout=${checkout}&adults=${adults}`;
        console.log('Appel API:', url);
        
        const response = await fetch(url);
        const rooms = await response.json();
        
        console.log('Chambres trouvÃ©es:', rooms);
        
        if (rooms.error) {
            alert('âŒ Erreur: ' + rooms.error);
            return;
        }
        
        if (rooms.length === 0) {
            alert('âŒ Aucune chambre disponible pour ces dates.');
        } else {
            const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
            alert(`âœ… ${rooms.length} chambre(s) disponible(s) pour ${nights} nuit(s) !`);
            document.querySelector('.rooms-section').scrollIntoView({behavior: 'smooth'});
        }
    } catch (error) {
        console.error('Erreur:', error);
        alert('âŒ Erreur: ' + error.message + '\n\nAssurez-vous que le serveur est dÃ©marrÃ© (node server.js)');
    }
}

// Fonction de rÃ©servation
async function bookRoom(roomType) {
    console.log('bookRoom appelÃ©e avec:', roomType);
    
    const checkinInput = document.getElementById('checkin');
    const checkoutInput = document.getElementById('checkout');
    const adultsInput = document.getElementById('adults');
    
    if (!checkinInput || !checkoutInput || !adultsInput) {
        alert('âš ï¸ Erreur: Ã‰lÃ©ments du formulaire introuvables');
        return;
    }
    
    const checkin = checkinInput.value;
    const checkout = checkoutInput.value;
    const adults = adultsInput.value;
    
    if (!checkin || !checkout) {
        alert('âš ï¸ Veuillez d\'abord effectuer une recherche avec vos dates de sÃ©jour !');
        document.querySelector('.search-box').scrollIntoView({behavior: 'smooth'});
        return;
    }
    
    const guestName = prompt('Votre nom complet:');
    if (!guestName) return;
    
    const guestEmail = prompt('Votre email:');
    if (!guestEmail) return;
    
    const guestPhone = prompt('Votre tÃ©lÃ©phone:');
    if (!guestPhone) return;
    
    const typeMap = {
        'Standard': 'standard',
        'Deluxe': 'premium',
        'PrÃ©sidentielle': 'presidential'
    };
    
    const booking = {
        roomType: typeMap[roomType] || 'standard',
        checkin: checkin,
        checkout: checkout,
        adults: adults,
        guestName,
        guestEmail,
        guestPhone
    };
    
    console.log('Envoi rÃ©servation:', booking);
    
    try {
        const response = await fetch(`${API_URL}/bookings`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(booking)
        });
        
        const result = await response.json();
        console.log('RÃ©sultat:', result);
        
        if (result.success) {
            alert(`âœ… RÃ©servation confirmÃ©e !\n\nNumÃ©ro: ${result.bookingId}\nTotal: Â£${result.booking.totalPrice} pour ${result.booking.nights} nuit(s)\n\nConfirmation envoyÃ©e Ã  ${guestEmail}`);
        } else {
            alert('âŒ Erreur: ' + (result.error || 'Erreur inconnue'));
        }
    } catch (error) {
        console.error('Erreur:', error);
        alert('âŒ Erreur: ' + error.message);
    }
}

// Fonctions pour la modal de connexion
function openLoginModal() {
    document.getElementById('loginModal').style.display = 'block';
}

function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
}

function handleLogin(event) {
    event.preventDefault();
    alert('Connexion en construction');
    closeLoginModal();
}

// Fermer la modal si clic en dehors
window.onclick = function(event) {
    const modal = document.getElementById('loginModal');
    if (event.target == modal) {
        closeLoginModal();
    }
}
</script>
    </body>
</html>